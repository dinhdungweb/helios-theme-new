{% schema %}
{
  "name": "Coverflow Slider",
  "settings": [],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Slide Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Coverflow Slider",
      "category": "Image"
    }
  ]
}
{% endschema %}

<div class="swiper coverflow-slider">
  <div class="swiper-wrapper">
    {% for block in section.blocks %}
      {% if block.settings.image != blank %}
        <div class="swiper-slide">
          <img
            src="{{ block.settings.image | image_url: width: 800 }}"
            srcset="{{ block.settings.image | image_url: width: 400 }} 400w,
                    {{ block.settings.image | image_url: width: 800 }} 800w,
                    {{ block.settings.image | image_url: width: 1200 }} 1200w"
            sizes="(max-width: 768px) 400px, 800px"
            loading="lazy"
            alt="Slide Image"
          >
        </div>
      {% endif %}
    {% endfor %}
  </div>
  <div class="coverflow-btn">
    <div class="swiper-coverflow-button-prev">{% render 'svg-chevron-left' %}</div>
    <div class="swiper-coverflow-button-next">{% render 'svg-chevron-right' %}</div>
  </div>
</div>

<style>
  .coverflow-slider {
    width: 100%;
    padding: 70px 0;
    overflow: hidden;
  }

  .coverflow-slider .swiper-slide {
    background: transparent;
    display: flex;
    justify-content: center;
    align-items: center;
    filter: grayscale(100%) brightness(60%) blur(3px);
    transform: scale(0.9);
    transition: all 0.4s ease;
    max-width: 700px;
    opacity: 0.7;
  }

  .coverflow-slider .swiper-slide img {
    width: 100%;
    height: auto;
    object-fit: cover;
    transition: all 0.4s ease;
  }

  .coverflow-slider .swiper-slide-active {
    filter: none;
    transform: scale(1.05);
    z-index: 10;
    opacity: 1;
  }
  .coverflow-btn {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 50px;
  }

  .swiper-coverflow-button-prev, .swiper-coverflow-button-next {
    line-height: 1;
    width: 50px;
    height: 50px;
    border: 1px solid #555;
    border-radius: 99px;
    background: transparent;
    align-content: center;
    text-align: center;
    color: #ddd;
    cursor: pointer;
  }

  .swiper-coverflow-button-prev:hover, .swiper-coverflow-button-next:hover {
    background: #ddd;
    color: #333;
  }
  @media screen and (max-width: 768px) {


    .coverflow-slider .swiper-slide {
      max-width: 300px; /* Đảm bảo slide chiếm toàn bộ chiều rộng */
      width: 100%;
      transform: scale(0.75);
      filter: grayscale(100%) brightness(50%) blur(2px);
      opacity: 0.6;
    }

    .coverflow-slider .swiper-slide img {
      width: 100%;
    }

    .coverflow-slider .swiper-slide-active {
      transform: scale(1); /* Đảm bảo slide active hiển thị đầy đủ */
      filter: none;
      opacity: 1;
    }
    
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const swiper = new Swiper(".coverflow-slider", {
      effect: "coverflow",
      grabCursor: true,
      centeredSlides: true,
      loop: true,
      slidesPerView: "auto",
      navigation: {
        nextEl: ".swiper-coverflow-button-next",
        prevEl: ".swiper-coverflow-button-prev"
      },

      coverflowEffect: {
        rotate: 40,
        stretch: 0,
        depth: 100,
        modifier: 1,
        slideShadows: false
      },
      breakpoints: {
        0: {
          slidesPerView: 1.3, // Đảm bảo slide chính hiển thị đầy đủ
          spaceBetween: 0,
          centeredSlides: true,
          coverflowEffect: {
            rotate: 0, // Tắt xoay trên di động
            depth: 0, // Tắt độ sâu để slide căn giữa
            modifier: 1,
            slideShadows: false
          }
        },
        768: {
          slidesPerView: "auto",
          centeredSlides: true
        }
      },
      on: {
        imagesReady: function () {
          this.update();
        }
      }
    });

    const resizeObserver = new ResizeObserver(() => {
      swiper.update();
    });
    resizeObserver.observe(document.querySelector(".coverflow-slider"));
  });
</script>